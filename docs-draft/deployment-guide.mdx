# Deployment Guide

The following instructions are the example deployment process for Logic Operating Centre (LOC). See [System Requirements](/docs/category/system-faqs#system-requirements) for requirement details. Please [contact us](/docs/about-and-contact) for assistance and service details.

LOC has been successfully installed and run on Amazon Web Services (AWS), Google Kubernetes Engine (GKE) as well as private on-premise clouds.

:::note
Some of the installation steps use codenames to represent components of LOC :

| LOC component   | Codename |
| --------------- | -------- |
| Core            | Saffron  |
| Studio backend  | Plankton |
| Studio frontend | Vanilla  |

These names are for installation only and do not concern general LOC usages.
:::

## 0. Prerequisites

#### 0-1. Environment

-   [Kubernetes](https://kubernetes.io/docs/setup/) v1.22+ with the following _recommended_ interface drivers:
    -   CRI (Container Runtime Interface): [CRI-O](https://cri-o.io/) v1.23.x
    -   CNI (Container Network Interface): [Cilium](https://cilium.io/) v1.12.x
    -   CSI (Container Storage Interface): [Ceph](https://docs.ceph.com/en/quincy/) v17.2.x / [Rook](https://rook.io/docs/rook/v1.10/Storage-Configuration/Ceph-CSI/ceph-csi-drivers/) v1.9.2
-   [Helm](https://helm.sh/docs/intro/install/) v3
-   [jq](https://stedolan.github.io/jq/download/)
-   [Git](https://git-scm.com/downloads)

<details>
  <summary>Setup RBAC for requesting FST Network to install LOC in your existing Kubernetes</summary>

If you already have a running Kubernetes environment, you can also requested us to install LOC for you. Here's the preparations you'll need.

First download our [user deployment template repository](https://github.com/fstnetwork/loc-user-deployment):

```bash
git clone https://github.com/fstnetwork/loc-user-deployment.git
cd loc-user-deployment
```

Grant permissions for cluster scope resources and add them into Kubernetes:

```bash
kubectl apply -f rbsc/permissions.yaml
kubectl apply -f rbsc/resources.yaml
```

If your **Amazon S3** solution is `Rook Ceph`, apply the following manifest:

```bash
kubectl apply -f rbsc/s3.yaml
```

If your **Elasticsearch** solution is `ECK Operator`, apply the following manifest:

```bash
kubectl apply -f rbsc/elastic.yaml
```

If your **PostgreSQL** solution is `Postgres Operator`, apply the following manifest:

```bash
kubectl apply -f rbsc/postgres.yaml
```

Add **Istio**:

```bash
kubectl apply -f rbsc/istio.yaml
```

Add **Cert Manager**:

```bash
kubectl apply -f rbsc/cert.yaml
```

Finally, open port `8443` for FST Network to access your Kubernetes cluster.

</details>

#### 0-2. Port Access

For an on-premise Kubernetes environment, the following ports (includes but not limited to) should be grant access on each Kubernetes nodes:

| Purpose  | Default Port                                                                            |
| -------- | --------------------------------------------------------------------------------------- |
| HTTP     | `80`                                                                                    |
| HTTPS    | `443`                                                                                   |
| ssh      | `22`                                                                                    |
| kubectl  | `8443`                                                                                  |
| FTP      | `21`                                                                                    |
| SMB      | `139`                                                                                   |
| Database | `3306` (MySQL), `5432` (PostgreSQL), `1434` (MS SQL Server) or `4443` (Oracle Database) |
| SMTP     | `25`, `465` or `578`                                                                    |

And any other ports you use for your own machines/services.

## 1. Download Deployment Template Files

<details>
  <summary>Expand</summary>

First download our [user deployment template repository](https://github.com/fstnetwork/loc-user-deployment):

```bash
git clone https://github.com/fstnetwork/loc-user-deployment.git
cd loc-user-deployment
```

This repository includes files we'll need in the following steps. **Be noted that many of them require proper modification** before use.

</details>

## 2. Add Helm Repositories

<details>
  <summary>Expand</summary>

```bash title="Add Apache Pulsar:"
helm repo add apache https://pulsar.apache.org/charts
```

```bash title="Add PostgreSQL operator:"
helm repo add postgres-operator https://raw.githubusercontent.com/zalando/postgres-operator/master/charts/postgres-operator
```

```bash title="Add Elasticsearch (ECK) operator:"
helm repo add elastic https://helm.elastic.co
```

```bash title="Add Keyclock:"
helm repo add bitnami https://charts.bitnami.com/bitnami
```

```bash title="Add Secrets Store CSI Driver:"
helm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts
```

```bash title="Add Vault:"
helm repo add hashicorp https://helm.releases.hashicorp.com
```

```bash title="Add LOC:"
helm repo add loc <loc_repo_domain>
```

:::info
`<loc_repo_domain>` is the Helm chart path provided by FST Network to authorised distributors. Please contact them for details. It would be something like this:

```
https://raw.githubusercontent.com/fst-network/saffron/master/charts/saffron
```

:::

Finally update Helm repositories:

```bash
helm repo update
```

</details>

## 3. Install Istio

<details>
  <summary>Expand</summary>

```bash title="Download istio:"
git clone https://github.com/istio/istio.git
```

```bash title="Install Istio operator:"
helm upgrade --install istio-operator istio/manifests/charts/istio-operator --create-namespace -n istio-operator -f loc-user-deployment/istio/value.yaml
```

:::info
Modify `loc-user-deployment/istio/value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/istio/value.yaml)) if needed.

> Reference: [Istio's Helm chart example](https://github.com/istio/istio/blob/master/manifests/charts/istio-operator/values.yaml)
> :::

```bash title="Install Istio in Kubernetes:"
kubectl apply -f loc-user-deployment/istio/istio.yaml
```

</details>

## 4. Install Apache Pulsar Cluster

<details>
  <summary>Expand</summary>

:::info
Modify `loc-user-deployment/pulsar/value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/pulsar/value.yaml)) if needed.

> Reference: [Pulsar's Helm chart example](https://github.com/apache/pulsar-helm-chart/blob/master/charts/pulsar/values.yaml)
> :::

```bash title="Install Pulsar cluster:"
helm upgrade --install --create-namespace -n pulsar-system pulsar apache/pulsar -f loc-user-deployment/pulsar/value.yaml
```

</details>

## 5. Setup Pulsar Tenants and Namespaces

<details>
  <summary>Expand</summary>

> Reference: [Pulsar admin interface](https://pulsar.apache.org/docs/2.10.x/admin-api-overview/)

```bash title="Create tenants:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin tenants create loc
```

```bash title="List all tenants:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin tenants list
```

```bash title="Create LOC/data-process-task namespace under tenants:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin namespaces create loc/data-process-task
```

```bash title="Create loc/healthz namespace under tenants:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin namespaces create loc/healthz
```

```bash title="Set topics retention time under the healthz namespace:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin namespaces set-message-ttl loc/healthz --messageTTL 300
```

```bash title="List all namespaces under saffron:"
kubectl -n pulsar-system exec -it pulsar-toolset-0 -- bin/pulsar-admin namespaces list saffron
```

</details>

## 6. Install PostgreSQL Operator and Secrets

<details>
  <summary>Expand</summary>

[Setup the Amazon S3 IAM policy](https://aws.amazon.com/premiumsupport/knowledge-center/s3-access-denied-listobjects-sync/?nc1=h_ls) with the following content:

```json title="loc-user-deployment/postgres/s3-iam-policy.json"
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": ["arn:aws:s3:::postgres-operator-wal/*"]
        }
    ]
}
```

:::warning
You **must** first create a S3 bucket named `postgres-operator-wal`.

Then modify the following files under `loc-user-deployment/postgres` before proceed:

-   `postgresql-infrastructure-roles.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/postgres/postgres-infrastructure-roles.yaml))
-   `postgres-env-overrides.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/postgres/postgres-env-overrides.yaml))
-   `value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/postgres/value.yaml))

> Reference: [Kubernetes Secrets](https://kubernetes.io/docs/feature/overview/configuration/secret/)
> :::

After setting up S3 policy:

```bash title="Install Postgresql operator:"
helm upgrade --install --create-namespace -n postgres-operator postgres-operator postgres-operator/postgres-operator -f loc-user-deployment/postgres/values.yaml
```

```bash title="Install postgres-infrastructure-roles in the same namespace 'postgres-operator':"
kubectl apply -f loc-user-deployment/postgres/postgres-infrastructure-roles.yaml -n postgres-operator
```

</details>

## 7. Install Elasticsearch (ECK) Operator

<details>
  <summary>Expand</summary>

```bash title="Install Elasticsearch with namespace 'eck-operator':"
helm upgrade --install --create-namespace -n eck-operator elastic/eck-operator -f loc-user-deployment/elastic/value.yaml
```

</details>

## 8. Install Keyclock and Related Resources

<details>
  <summary>Expand</summary>

### 8-i. Setup Postgresql for KeyClock

:::warning
Modify `postgresql-infra.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/keyclock/postgresql-infra.yaml)) under `loc-user-deployment/keyclock` before proceed.

> Reference: [Postgres Operator's manifest example](https://github.com/zalando/postgres-operator/blob/master/manifests/complete-postgres-manifest.yaml)
> :::

```bash title="Create namespace 'infra':"
kubectl create ns infra
```

```bash title="Install Postgresql for Keyclock:"
kubectl apply -f loc-user-deployment/keyclock/postgresql-infra.yaml
```

```bash title="Confirm Postgresql is up and running:"
kubectl -n infra get postgresql
```

### 8-ii. Retrieve Keyclock Owner and Password

```bash title="List all secrets under namespace 'infra':"
kubectl -n infra get secret
```

```bash title="Retrieve keyclock owner from secret:"
kubectl -n infra get secret keycloak-owner-user.infra-database.credentials.postgresql.acid.zalan.do -o=go-template='{{.data.username| base64decode}}'
```

```bash title="Retrieve keyclock password from secret:"
kubectl -n infra get secret keycloak-owner-user.infra-database.credentials.postgresql.acid.zalan.do -o=go-template='{{.data.password| base64decode}}'
```

### 8-iii. Install Keyclock

:::warning
Modify the following files under `loc-user-deployment/keyclock` before proceed:

-   `value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/keyclock/value.yaml)) ([reference](https://github.com/bitnami/charts/blob/main/bitnami/keycloak/values.yaml))
-   `gateway.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/keyclock/gateway.yaml)) ([reference](https://istio.io/latest/docs/reference/config/networking/gateway/))
-   `virtualservice.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/keyclock/virtualservice.yaml)) ([reference](https://istio.io/latest/docs/reference/config/networking/virtual-service/))
    :::

```bash title="Install Keyclock:"
helm upgrade --install --create-namespace -n keycloak keycloak bitnami/keycloak -f loc-user-deployment/keyclock/values.yaml
```

```bash title="Setup Ingress virtual service:"
kubectl apply -f loc-user-deployment/keyclock/virtualservice.yaml
```

```bash title="Setup Ingress gateway:"
kubectl apply -f loc-user-deployment/keyclock/gateway.yaml
```

### 8-iv. Retrieve Keyclock Access Token and Configure Keyclock

```bash title="Get master realm access token:"
curl --location --request POST 'https://<your_keyclock_domain_name>/auth/realms/master/protocol/openid-connect/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'client_id=admin-cli' \
--data-urlencode 'username=test-admin' \  # owner in keyclock/value.yaml
--data-urlencode 'password=test-admin' \  # password in keyclock/value.yaml
--data-urlencode 'grant_type=password'
```

:::warning
Replace the following commands with your own keyclock domain and the access token you get from above.
:::

```bash title="Extend master realm access token's life span to 10 min:"
curl --location --request PUT 'https://<your_keyclock_domain_name>/auth/realms/master' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
--data-raw '{
    "accessTokenLifespan": 600
}'
```

```bash title="Create Keyclock realm:"
curl --location --request POST 'https://<your_keyclock_domain_name>/auth/admin/realms' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
--data-raw '{
    "id": "loc",
    "realm": "loc",
    "enabled": true,
    "sslRequired": "external",
    "registrationAllowed": false,
    "loginWithEmailAllowed": true,
    "duplicateEmailsAllowed": false,
    "resetPasswordAllowed": false,
    "editUsernameAllowed": false
}'
# modify the JSON if needed
```

:::info
See [Keyclock Realms Admin](https://www.keycloak.org/docs-api/16.1/rest-api/#_realms_admin_resource) for reference.
:::

```bash title="Confirm Keyclock realm:"
curl --location --request GET 'https://<your_keyclock_domain_name>/auth/admin/realms/loc' \
--header 'Authorization: Bearer <your_keyclock_access_token>'
```

### 8-v. Create Keyclock Clients for LOC Studio

```bash title="Create Keyclock client for LOC Studio backend:"
curl --location --request POST 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/clients' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
--data-raw '{
    "clientId": "loc-studio-backend",
    "name": "loc-studio-backend",
    "authorizationServicesEnabled": false,
    "bearerOnly": false,
    "directAccessGrantsEnabled": true,
    "enabled": true,
    "protocol": "openid-connect",
    "clientAuthenticatorType": "client-secret",
    "redirectUris": ["*"],
    "standardFlowEnabled": true,
    "serviceAccountsEnabled": true,
    "publicClient": false,
    "defaultRoles": [
      "view-users"
    ]
}
```

```bash title="Get LOC Studio backend's client id:"
curl --location --request GET 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/clients' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.[] | select(.clientId=="loc-studio-backend").id'
```

```bash title="Get LOC Studio backend's service account id:"
curl --location --request GET 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/clients/${client_id}/service-account-user' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.id'
```

```bash title="Get Keyclock Realm management's client id:"
curl --location --request GET 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/clients' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.[] | select(.clientId=="realm-management").id'
```

```bash title="Get Keyclock Realm management's view-users role id:"
curl --location --request GET 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/users/${service_account_id}/role-mappings/clients/${realm-management_client_id}' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.[] | select(.name=="view-users").id'
```

```bash title="Add permission to view-users:"
curl --location --request POST 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/users/${service_account_id}/role-mappings/clients/${realm-management_client_id}' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
--data-raw '{
    "id":"${realm-management_view_users_role_id}",
    "name":"view-users",
    "composite":true,
    "clientRole":true,
    "containerId":"${realm-management_client_id}"
}'
```

```bash title="Create Keyclock client for LOC Studio frontend:"
curl --location --request POST 'https://<your_keyclock_domain_name>/auth/admin/realms/loc/clients' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
--data-raw '{
    "clientId": "loc-studio-frontend",
    "name": "loc-studio-frontend",
    "authorizationServicesEnabled": false,
    "bearerOnly": false,
    "directAccessGrantsEnabled": true,
    "enabled": true,
    "protocol": "openid-connect",
    "clientAuthenticatorType": "client-secret",
    "redirectUris": ["*"],
    "webOrigins": ["*"],
    "standardFlowEnabled": true,
    "serviceAccountsEnabled": true,
    "publicClient": true
}
```

</details>

## 9. Install Secrets Store CSI Driver

<details>
  <summary>Expand</summary>

:::warning
Modify `value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/secrets-store-csi-driver/value.yaml)) under `loc-user-deployment/secrets-store-csi-driver` before proceed.

> Reference: [Secrets Store CSI Driver's Helm chart example](https://github.com/kubernetes-sigs/secrets-store-csi-driver/blob/main/charts/secrets-store-csi-driver/values.yaml)
> :::

```bash title="Install Secrets Store CSI Driver:"
helm upgrade --install --create-namespace -n secrets-store-csi-driver secrets-store-csi-driver csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver -f loc-user-deployment/secrets-store-csi-driver/values.yaml
```

</details>

## 10. Install and Configure Vault

<details>
  <summary>Expand</summary>

### 10-i. Install Vault

:::warning
Modify the following files under `loc-user-deployment/vault` before proceed:

-   `value.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/vault/value.yaml)) ([reference](https://github.com/hashicorp/vault-helm/blob/main/values.yaml))
-   `gateway.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/vault/gateway.yaml)) ([reference](https://istio.io/latest/docs/reference/config/networking/gateway/))
-   `virtualservice.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/vault/virtualservice.yaml)) ([reference](https://istio.io/latest/docs/reference/config/networking/virtual-service/))
    :::

```bash title="Install Vault:"
helm upgrade --install --create-namespace -n vault vault hashicorp/vault -f loc-user-deployment/vault/values.yaml
```

```bash title="Setup Ingress virtual service:"
kubectl apply -f loc-user-deployment/vault/virtualservice.yaml
```

```bash title="Setup Ingress gateway:"
kubectl apply -f loc-user-deployment/vault/gateway.yaml
```

### 10-ii. Configure Vault

> Reference: [Highly Available Vault Cluster with Integrated Storage](https://developer.hashicorp.com/vault/docs/platform/k8s/helm/examples/ha-with-raft)

```bash title="Store 5 unseal key and root token to key.txt:"
kubectl -n vault exec -it vault-0 -- vault operator init | sed 's/\x1B\[[0-9;]\{1,\}[A-Za-z]//g' > key.txt
```

#### Vault 0

```bash title="Use 3 of the keys to unseal valut 0:"
kubectl exec -ti vault-0 -- vault operator unseal $(grep 'Key 1:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-0 -- vault operator unseal $(grep 'Key 2:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-0 -- vault operator unseal $(grep 'Key 3:' key.txt | awk '{print $NF}')
```

#### Vault 1

```bash title="Add vault 1 to vault 0 cluster:"
kubectl exec -ti vault-1 -- vault operator raft join http://vault-0.vault-internal:8200
```

```bash title="Use 3 of the keys to unseal valut 1:"
kubectl exec -ti vault-1 -- vault operator unseal $(grep 'Key 1:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-1 -- vault operator unseal $(grep 'Key 2:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-1 -- vault operator unseal $(grep 'Key 3:' key.txt | awk '{print $NF}')
```

#### Vault 2

```bash title="Add vault 2 to vault 0 cluster:"
kubectl exec -ti vault-2 -- vault operator raft join http://vault-0.vault-internal:8200
```

```bash title="Use 3 of the keys to unseal valut 1:"
kubectl exec -ti vault-2 -- vault operator unseal $(grep 'Key 1:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-2 -- vault operator unseal $(grep 'Key 2:' key.txt | awk '{print $NF}')
```

```bash
kubectl exec -ti vault-2 -- vault operator unseal $(grep 'Key 3:' key.txt | awk '{print $NF}')
```

### 10-iii. Login Vault with Root Token

```bash
kubectl -n vault exec -it vault-0 -- vault login $(grep 'Initial Root Token:' key.txt | awk '{print $NF}')
```

### 10-iv. Setup Kubernetes Authentication

> Reference: [Kubernetes Auth Method](https://developer.hashicorp.com/vault/docs/auth/kubernetes)

```bash
vault auth enable kubernetes
```

```bash
vault write auth/kubernetes/config token_reviewer_jwt="$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" kubernetes_host=https://kubernetes.default.svc.cluster.local:443 kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
```

### 10-v. Start Vault KV Secret Engine

> Reference: [Vault kv command](https://developer.hashicorp.com/vault/docs/commands/kv)

Use the example script `create_policy.sh` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/vault/create_policy.sh)) under `loc-user-deployment/vault` (modify before use if needed):

```bash
./loc-user-deployment/vault/create_policy.sh ${vault-ui_address_domain} loc
```

</details>

## 11. Install LOC

<details>
  <summary>Expand</summary>

### 11-i. Setup LOC's S3 IAM Policy

[Setup the Amazon S3 IAM policy](https://aws.amazon.com/premiumsupport/knowledge-center/s3-access-denied-listobjects-sync/?nc1=h_ls) with the following content:

```json title="loc-user-deployment/loc/s3-iam-policy.json"
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": "arn:aws:s3:::your_bucket_name/*"
        }
    ]
}
```

### 11-ii. Prepare LOC Setup

```bash title="Get Keyclock LOC realm's RSA256 public key:"
curl --location --request GET https://<your_keycloak_domain>/auth/admin/realms/loc/keys \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.keys | .[] | select(.algorithm=="RS256").publicKey'
```

And modify the following files under `loc-user-deployment/loc` before proceed:

-   `saffron-s3.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/loc/saffron-s3.yaml))
-   `core/values.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/loc/core/values.yaml))

You should also add the RSA256 public key to `studio-backend/values.yaml` (see the next section).

:::info
`${loc_registry}` in `values.yaml` is also provided by FST Network to authorised distributors. It would be something like this:

```
public.ecr.aws/m0s8xxxx/saffron/evenstrore
```

:::

### 11-iii. Install LOC Core

```bash title="Create namespace 'loc':"
kubectl create namespace loc
```

```bash title="Create S3 secret:"
kubectl apply -f loc-user-deployment/loc/saffron-s3.yaml
```

```bash title="Install LOC Core:"
helm install -n loc saffron loc/saffron -f loc-user-deployment/loc/core/value.yaml
```

### 11-iv. Install LOC Studio backend

```bash title="List secrets under namespace 'loc':"
kubectl -n loc get secret
```

```bash title="Get client ID:"
curl --location --request GET 'https://<your_keycloak_domain>/auth/admin/realms/loc/clients' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.[] | select(.clientId=="loc-studio-backend").id'
```

```bash title="Get client credential secret:"
curl --location --request GET 'https://<your_keycloak_domain>/auth/admin/realms/loc/clients/<your_client_id>/client-secret' \
--header 'Authorization: Bearer <your_keyclock_access_token>' \
| jq '.value'
# use the client id you get from above
```

And modify `studio-backend/values.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/loc/studio-backend/value.yaml)) under `loc-user-deployment/loc` before proceed.

```bash title="Install LOC Studio backend:"
helm install -n loc plankton loc/plankton -f loc-user-deployment/loc/studio-backend/value.yaml
```

### 11-v. Install LOC Studio frontend

```bash title="Get service name of LOC Studio backend:"
kubectl -n loc get svc |grep plankton
```

And modify `studio-frontend/values.yaml` ([link](https://github.com/fstnetwork/loc-user-deployment/blob/main/loc/studio-frontend/value.yaml)) under `loc-user-deployment/loc` before proceed.

```bash title="Install LOC Studio frontend:"
helm install -n loc vanilla loc/vanilla -f loc-user-deployment/loc/studio-frontend/value.yaml
```

</details>

---

And that's all you need to setup your own LOC distribution.
